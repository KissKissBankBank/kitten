import { Meta, Canvas, Story } from '@storybook/addon-docs'
import {
  CurrentStyle,
  BasicStyle,
  BorderStyle,
  DefaultStyle,
} from './focus-outline.js'
import { Text } from 'kitten'

<Meta title="Documentation/AccessibilitÃ©/Indicateurs de focus" />

# AccessibilitÃ©: Indicateurs de focus

## Ressources

- [CritÃ¨res et tests - RGAA](https://www.numerique.gouv.fr/publications/rgaa-accessibilite/methode-rgaa/criteres/#crit-10-7)
- [Guide de lâ€™intÃ©grateur RGAA 3](https://disic.github.io/guide-integrateur/7-focus.html#outline)
- [A guide to designing accessible, WCAG-compliant focus indicators](https://www.sarasoueidan.com/blog/focus-indicators/)

## CritÃ¨re de conformitÃ©

> **CritÃ¨re 10.7. Dans chaque page web, pour chaque Ã©lÃ©ment recevant le focus, la [prise de focus](https://www.numerique.gouv.fr/publications/rgaa-accessibilite/methode-rgaa/glossaire/#prise-de-focus) est-elle visibleÂ ?**<br/>
> Test 10.7.1Â :<br/>
> Pour chaque Ã©lÃ©ment recevant le focus, la [prise de focus](https://www.numerique.gouv.fr/publications/rgaa-accessibilite/methode-rgaa/glossaire/#prise-de-focus) vÃ©rifie-t-elle une de ces conditionsÂ ?
>
>  â€¢ Le style du focus natif du navigateur nâ€™est pas supprimÃ© ou dÃ©gradÃ©Â ;<br/>
>  â€¢ Un style du focus dÃ©fini par lâ€™auteur est visible.
>

### Design

La rÃ¨gle *2.4.11:Focus Appearance (Minimum)* requiert qu'il y ait **une zone de la surface de lâ€™indication de focus** (Ã  lâ€™intÃ©rieur de la surface de lâ€™indication du focus) qui a **un contraste avec un rapport de 3:1** entre les couleurs dans lâ€™Ã©tat non-focus et lâ€™Ã©tat focus. Cette surface est appelÃ©e la **zone de contraste**.

Cette zone de contraste peut potentiellement recouvrir lâ€™intÃ©gralitÃ© de la surface dâ€™indication de focus.

Plus le contraste est important entre la couleur de non-focus et la couleur de focus, plus c'est facile pour les utilisateurs de voir la diffÃ©rence.

#### Surface de la zone de contraste

La rÃ¨gle 2.4.11 dÃ©finit aussi que la zone de contraste couvre une **Ã©tendue minimum**. Ce minimum est dÃ©terminÃ© en faisant un calcul basÃ© sur le pÃ©rimÃ¨tre du composant.

Il y a deux choix :

- Cette Ã©tendue minimum est Ã©gale Ã  une ligne dâ€™un pixel autour de lâ€™extÃ©rieur du composant non-focus.<br/>Si la surface de contraste se situe Ã  lâ€™intÃ©rieur du bouton, une ligne dâ€™un pixel dâ€™Ã©paisseur sera infÃ©rieure Ã  lâ€™Ã©tendue minimum, donc il faut que cette ligne ait une Ã©paisseur de 2px.
- L'aire de contraste doit Ãªtre au moins aussi large que lâ€™Ã©tendue dâ€™une ligne de 4px dâ€™Ã©paisseur le long du plus petit cÃ´tÃ© du composant.



**La zone de contraste peut satisfaire la premiÃ¨re ou la deuxiÃ¨me rÃ¨gle pour Ãªtre valide.**

#### Couleur de la zone de contraste

La couleur de la zone de contraste doit prÃ©senter **un contraste entre lâ€™Ã©tat focus et lâ€™Ã©tat non-focus**. La zone de contraste doit aussi prÃ©senter **un contraste entre la couleur de lâ€™Ã©tat focus, et les couleurs adjacentes au sein du composant**.

Un composant est conforme Ã  la rÃ¨gle si, au choix :

- La couleur de la zone de contraste prÃ©sente un contraste minimum de 3:1 avec la zone adjacente ;
- La zone de contraste a une Ã©paisseur de 2px minimum ;
- La zone de contraste est sÃ©parÃ©e du composant.

#### Remarque

Le composant qui reÃ§oit le focus ne doit pas Ãªtre partiellement cachÃ© par des autres contenus.

#### Pour aller plus loin

La rÃ¨gle 2.4.12 permet dâ€™atteindre un niveau AAA (contre AA pour la 2.4.11), pour cela elle renforce le contraste :

- La surface de la zone de contraste est Ã©gale au **double de la surface dâ€™une ligne dâ€™un pixel autour de lâ€™extÃ©rieur du composant non-focus**.
- Les contrastes de couleurs (entre zone de contraste non-focus et focus, et entre zone de contraste et Ã©lÃ©ments adjacents) sont montÃ©s Ã  **4,5:1**.
- Aucune partie de lâ€™Ã©lÃ©ment qui reÃ§oit le focus ne doit Ãªtre cachÃ©e par des autres contenus.

### Code

> **Le RGAA impose de conserver la propriÃ©tÃ© outline**. Dans les feuilles de style, il est interdit de trouver des propriÃ©tÃ©s visant Ã  supprimer cet outline Ã  la prise de focus (`:focus`).<br/>
> â€¦<br/>
> MÃªme si vous utilisez une bordure (`border`) pour signifier la prise de focus, cette alternative n'est pas considÃ©rÃ©e comme pertinente.
En effet, outline est une propriÃ©tÃ© gÃ©rÃ©e par le navigateur. Certains navigateurs proposent des mÃ©canismes qui permettent dâ€™augmenter la visibilitÃ© de cet outline. Ainsi, si dans vos feuilles de style, vous indiquez `outline:0`, les paramÃ¨tres du navigateur visant Ã  augmenter lâ€™outline seront invisibles.


Pour limiter lâ€™apparition des outlines Ã  la seule navigation au clavier, et non plus au clic, lâ€™usage de `focus-visible` est conseillÃ© :

```css
button:focus {
  /* des styles de focus */
}

button:focus:not(:focus-visible) {
 /* annulation des styles de focus */
}

button:focus-visible {
 /* des styles de focus qui n'apparaissent qu'Ã  la navigation au clavier */
}
```

Ce pattern de code est dÃ©jÃ  en place sur la majeure partie des Ã©lÃ©ments focusables de Kitten.

## Tests

Pour se rendre compte des styles de focus de chaque composant, utilisez la touche `Tab` (â‡¥) pour lâ€™Ã©lÃ©ment suivant, ou `Maj Tab` (â‡§ â‡¥) pour le prÃ©cÃ©dent.

ğŸ”° Le bouton Hydrogen (fond blanc) respecte le style hover/active de la prochaine mise Ã  jour des couleurs, comme vu dans les maquettes du Design System.

----

### Style Actuel

Bordure de 2px de large, de couleur primary4 (correspondra au "blue 300, light blue"), situÃ©e Ã  2px de distance Ã  lâ€™extÃ©rieur du composant.

<CurrentStyle />

- âœ”ï¸ Surface OK (La surface est Ã©gale Ã  2px autour de lâ€™extÃ©rieur du composant non-focus)
- âœ”ï¸ Couleur OK (La zone de contraste a une Ã©paisseur de 2px minimum et la zone de contraste est sÃ©parÃ©e du composant)

----

### Style A : Contour basique

Bordure de 2px de large, de couleur primary3 (correspondra au "blue 900, very dark blue"), situÃ©e contre le composant.

<BasicStyle />

- âœ”ï¸ Surface OK (La surface est Ã©gale Ã  2px autour de lâ€™extÃ©rieur du composant non-focus)
- âœ”ï¸ Couleur OK (La zone de contraste a une Ã©paisseur de 2px minimum)


----


### Style B : Bordure

Bordure de 2px de large, de couleur primary3 (correspondra au "blue 900, very dark blue"), situÃ©e Ã  la place de la bordure (donc Ã  lâ€™intÃ©rieur du composant).

<BorderStyle />

- âœ”ï¸ Surface OK (La surface est Ã©gale Ã  2px autour de lâ€™extÃ©rieur du composant non-focus)
- âœ–ï¸ Couleur NOK (Sur les boutons Helium, il n'y a pas pas assez de contraste entre la zone de contraste et la couleur adjacente du composant)



----


### Style C : Par dÃ©faut

Le comportement par dÃ©faut de ces composants peut Ãªtre testÃ© avec cet exemple. Lâ€™apparence varie selon le navigateur, et il est possible que certains navigateurs ne fournissent pas une expÃ©rience accessible.

<DefaultStyle />

<div className="has-overrides dark-background" style={{ padding: '2em 0' }}>
  <Text weight="regular" color="background1" className="k-u-margin-bottom-triple k-u-margin-left-quadruple">
    Sur fond noir, les navigateurs ne rendent pas lâ€™outline de la mÃªme maniÃ¨re.
  </Text>
  <DefaultStyle />
</div>
